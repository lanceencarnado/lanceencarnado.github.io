const NORMAL=1,FLIP=2,IPHONE_PORTRAIT_NORMAL=6,IPHONE_PORTRAIT_FLIP=5;var exifOrientation,$uploadCrop,tempFilename,rawImg,imageId,currentFaceNum,croppieOrientation=1;function readFile(a){if(a.files&&a.files[0]){var e=new FileReader;e.onload=function(e){$("#upload-demo").addClass("ready"),$("#cropImagePop").modal("show"),rawImg=e.target.result,a.value=null},e.readAsDataURL(a.files[0])}else swal("Sorry - either there was an error, or your browser doesn't support the FileReader API. Please try again.")}function croppieOrientFlipHorizontal(a){switch(a){case 1:a=2;break;case 2:a=1;break;case 3:a=4;break;case 4:a=3;break;case 5:a=6;break;case 6:a=5;break;case 7:a=8;break;case 8:a=7}return a}function croppieOrientRotateRight(a){switch(a){case 1:a=6;break;case 2:a=7;break;case 3:a=8;break;case 4:a=5;break;case 5:a=2;break;case 6:a=3;break;case 7:a=4;break;case 8:a=1}return a}function drawRotatedImage(a,e,t,o,i,r,n){var l=Math.PI/180;e.save(),e.translate(t+r/2,o+n/2),e.rotate(i*l),e.drawImage(a,-r/2,-n/2,r,n),e.restore()}function createInitialBillCanvas(){var a=document.getElementById("initialbillcanvas"),e=a.getContext("2d");e.clearRect(0,0,a.width,a.height);var t=new Image;t.onload=function(){e.drawImage(t,209,0),faceFilter(t,e,209,0);var o=new Image;o.onload=function(){var e=a.getContext("2d");e.globalCompositeOperation="overlay",e.drawImage(o,209,0),e.globalCompositeOperation="source-over";var t=new Image;t.onload=function(){a.getContext("2d").drawImage(t,0,0,945,402),createFinalBillCanvas()},t.src="assets/billcutout.png"},o.src="assets/noisefilter.jpg"},t.src=$("#faceimg").attr("src")}function faceFilter(a,e,t,o){for(var i=e.getImageData(t,o,a.width,a.height),r=i.data,n=0;n<r.length;n+=4){var l=.34*r[n]+.5*r[n+1]+.16*r[n+2];r[n]=l,r[n+1]=l,r[n+2]=l}e.putImageData(i,t,o),e.globalCompositeOperation="multiply",e.fillStyle="#ffffe1",e.fillRect(t,o,a.width,a.height),e.globalCompositeOperation="screen",e.fillStyle="#505a51",e.fillRect(t,o,a.width,a.height),e.globalCompositeOperation="source-over"}function playCameraFlashAnimation(){$("#cameraflash").animate({opacity:"1"},200,"linear",function(){$("#cameraflash").animate({opacity:"0"},1200,"linear")})}function createFinalBillCanvas(){var a=document.getElementById("finalrodcanvas"),e=document.getElementById("initialbillcanvas"),t=a.getContext("2d");t.clearRect(0,0,a.width,a.height);var o=new Image;o.onload=function(){t.drawImage(o,0,0),t.shadowColor="rgba(0, 0, 0, 0.4)",t.shadowBlur=8,t.shadowOffsetX=4,t.shadowOffsetY=4,drawRotatedImage(e,t,-46,91,-4.47,945,402),drawRotatedImage(e,t,765,798,-13.01,945,402),drawRotatedImage(e,t,-149,329,-14.61,945,402),drawRotatedImage(e,t,44,812,15.38,945,402),drawRotatedImage(e,t,-430,1094,-66,945,402),drawRotatedImage(e,t,469,1215,-102.3,945,402),drawRotatedImage(e,t,-565,142,18,945,402),drawRotatedImage(e,t,423,400,102.2,945,402),drawRotatedImage(e,t,129,403,-7.53,945,402),t.shadowColor="rgba(0, 0, 0, 0)";var i=new Image;i.onload=function(){t.drawImage(i,0,0);var e=a.toDataURL("image/jpeg",1);$("#billgeneratedimg").attr("src",e),playCameraFlashAnimation(),$("#download-btn").attr("class","rodbutton")},i.src="assets/frame.png"},o.src="assets/bill_background.jpg"}$uploadCrop=window.innerWidth<=768?$("#upload-demo").croppie({viewport:{width:"min(70vw, 380px)",height:"min(70vw, 380px)"},boundary:{width:"min(80vw, 420px)",height:"min(80vw, 420px)"},enforceBoundary:!1,enableExif:!0,enableOrientation:!0}):$("#upload-demo").croppie({viewport:{width:380,height:380},boundary:{width:420,height:420},enforceBoundary:!1,enableExif:!0,enableOrientation:!0}),$("#cropImagePop").on("shown.bs.modal",function(){var a=$(".modal-body").width();console.log(a),$uploadCrop.croppie("bind",{url:rawImg}).then(function(){console.log("jQuery bind complete");var a=new Image;a.src=rawImg,EXIF.getData(a,function(){6==(exifOrientation=EXIF.getTag(this,"Orientation"))&&(croppieOrientation=6)})})}),$(".uploadface-btn").on("change",function(){imageId=$(this).data("id"),tempFilename=$(this).val(),$("#cancelCropBtn").data("id",imageId),readFile(this)}),$("#flipImageBtn").on("click",function(){croppieOrientation=croppieOrientFlipHorizontal(croppieOrientation),$uploadCrop.croppie("bind",{url:rawImg,orientation:croppieOrientation})}),$("#rotateBtn").on("click",function(a){croppieOrientation=croppieOrientRotateRight(croppieOrientation),$uploadCrop.croppie("bind",{url:rawImg,orientation:croppieOrientation})}),$("#cropImageBtn").on("click",function(a){$uploadCrop.croppie("result",{type:"base64",format:"png",backgroundColor:"#FFFFFF",size:{width:402,height:402}}).then(function(a){$("#faceimg").attr("src",a),$("#cropImagePop").modal("hide"),createInitialBillCanvas()})}),download_canvas_img=function(a){var e=document.getElementById("finalrodcanvas").toDataURL("image/jpeg");a.href=e};
